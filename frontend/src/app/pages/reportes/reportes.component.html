<section class="page">
  <header class="page-header">
    <div>
      <h2>Reportes</h2>
      <p>Estado de cuenta con resumen JSON y PDF.</p>
    </div>
  </header>

  <form class="reporte-form card" (ngSubmit)="buscarReporte()">
    <label>
      Fecha inicio
      <input type="date" [(ngModel)]="fechaInicio" name="fechaInicio" required />
    </label>

    <label>
      Fecha fin
      <input type="date" [(ngModel)]="fechaFin" name="fechaFin" required />
    </label>

    <label>
      Cliente ID
      <input type="number" [(ngModel)]="clienteId" name="clienteId" min="1" required />
    </label>

    <div class="form-actions">
      <button type="submit" [disabled]="isLoading">Buscar</button>
      <button type="button" (click)="descargarPdf()" [disabled]="!reporte?.pdfBase64">Descargar PDF</button>
    </div>
  </form>

  <p class="mensaje error" *ngIf="errorMessage">{{ errorMessage }}</p>
  <p class="mensaje info" *ngIf="infoMessage">{{ infoMessage }}</p>

  <div class="resumen-grid" *ngIf="reporte">
    <div class="card">
      <h3>Cliente</h3>
      <p><strong>{{ reporte.cliente.nombre }}</strong></p>
      <p>ID: {{ reporte.cliente.clienteId }}</p>
    </div>

    <div class="card">
      <h3>Resumen de cuentas</h3>
      <table>
        <thead>
          <tr>
            <th>Cuenta</th>
            <th>Tipo</th>
            <th>Saldo</th>
            <th>Débitos</th>
            <th>Créditos</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let cuenta of reporte.cuentas">
            <td>{{ cuenta.numeroCuenta }}</td>
            <td>{{ cuenta.tipoCuenta }}</td>
            <td>{{ cuenta.saldoActual | number: '1.2-2' }}</td>
            <td>{{ cuenta.totalDebitos | number: '1.2-2' }}</td>
            <td>{{ cuenta.totalCreditos | number: '1.2-2' }}</td>
          </tr>
          <tr *ngIf="reporte.cuentas.length === 0">
            <td colspan="5">Sin cuentas disponibles.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="card" *ngIf="reporte">
    <h3>Resumen JSON</h3>
    <pre>{{ reporte | json }}</pre>
  </div>

  <div class="tabla-wrapper" *ngIf="reporte?.movimientos?.length">
    <table>
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Cliente</th>
          <th>Cuenta</th>
          <th>Tipo</th>
          <th>Saldo inicial</th>
          <th>Movimiento</th>
          <th>Saldo disponible</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let movimiento of reporte?.movimientos">
          <td>{{ movimiento.fecha | date: 'yyyy-MM-dd HH:mm' }}</td>
          <td>{{ movimiento.cliente }}</td>
          <td>{{ movimiento.numeroCuenta }}</td>
          <td>{{ movimiento.tipoCuenta }}</td>
          <td>{{ movimiento.saldoInicial | number: '1.2-2' }}</td>
          <td>{{ movimiento.movimiento | number: '1.2-2' }}</td>
          <td>{{ movimiento.saldoDisponible | number: '1.2-2' }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</section>
